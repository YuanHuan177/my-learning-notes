# 文本相似度--BM25

BM25算法是一种常见用来做相关度打分的公式，思路比较简单，主要就是计算一个query里面所有词q1，q2，...，qn 和文档的相关度，然后再把分数做累加操作。公式如下： 

$$Score(Q,d)= \sum_i^n Wi*R(q_i,d)$$

其中 $$R(q_i,d)$$ 是查询语句 query 中每个词 qi 和文档 d 的相关度值，$$W_i$$ 是该词的权重。

Wi 一般情况下为IDF(InverseDocumentFrequency)值，即逆向文档频率。

$$R(qi,d)$$ 公式如下： 

$$R(qi,d)=\frac{f_i*(k_1+1)}{f_i+K} * \frac{qf_i*(k_2+1)}{qf_i+k_2}$$

$$K=k1⋅(1−b+b* \frac{dl}{avgdl})$$

其中 $$k_1,k_2,b$$ 都是调节因子，一般 $$k_1=1,k_2=1,b=0.75$$。 

式中 $$qf_i$$为词 $$q_i$$ 在查询语句 query 中的出现频率，$$f_i$$ 为 $$q_i$$ 在文档 $$d$$ 中的出现频率。由于绝大多数情况下一条简短的查询语句 query 中，词 $$q_i$$ 只会出现一次，即 $$qf_i=1$$。

dl 为文档 d 的长度，avgdl 为所有文档的平均长度。意即该文档d的长度和平均长度比越大，则K 越大，则相关度 $$R(q_i,d)$$ 越小,b 为调节因子，b 越大，则文档长度所占的影响因素越大，反之则越小。

```
例子：
query：诸葛亮在哪里去世的？ 
document1：诸葛亮在五丈原积劳成疾，最终去世； 
document2：司马懿与诸葛亮多次在五丈原交锋； 
document3：为一整本中国历史书的内容。 

显然document3中肯定包含了大量[诸葛亮]、[哪里]、[去世]这些词语，可是由于document3
文档长度太大，所以K非常大，所以和 query 中每个词 qi 的相关度 R(qi,d) 非常小。
```
综上所述，可将BM25相关度打分算法的公式整理为：

$$Score(Q,d)=\sum_i^n IDF(q_i)* \frac{f_i*(k_1+1)}{f_i+k_1*(1−b +b* \frac{dl}{avgdl})}$$


## BM25优缺点

适用于：在文档包含查询词的情况下，或者说查询词精确命中文档的前提下，如何计算相似度，如何对内容进行排序。

不适用于：基于传统检索模型的方法会存在一个固有缺陷，就是检索模型只能处理 Query 与 Document 有重合词的情况，传统检索模型无法处理词语的语义相关性。

也就是 BM25 算法只能计算 字面 相似度，而不能计算语义之间的相似度。